{% extends "base.html" %}
{% block content %}

<div class="container my-5">

  <div class="row">
    <div class="col-lg-8 mx-auto">

      <!-- Back to list link -->
      <a href="{% url 'activities:list' %}" class="btn btn-outline-secondary mb-4">
        ← Back to Upcoming Events
      </a>

      <div class="card shadow-lg border-0">

        <!-- Featured badge (top-left) -->
        {% if event.is_featured %}
        <span class="position-absolute top-0 start-0 badge bg-warning text-dark m-3 fs-5 px-3 py-2">
          Featured
        </span>
        {% endif %}
        <!-- Poster – thumbnail with modal trigger -->
        {% if event.poster %}
        <div class="text-center p-3">
          <img src="{{ event.poster.url }}" 
               class="img-fluid rounded shadow-sm" 
               alt="{{ event.title }}" 
               style="max-height: 320px; cursor: pointer; object-fit: contain;"
               data-toggle="modal" 
               data-target="#posterModal"
               title="Click to enlarge">
        </div>
        <!-- Modal for full-size poster -->
        <div class="modal fade" id="posterModal" tabindex="-1" aria-labelledby="posterModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="posterModalLabel">{{ event.title }} – Poster</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body text-center p-0">
                <img src="{{ event.poster.url }}" 
                     class="img-fluid" 
                     alt="{{ event.title }}" 
                     style="max-height: 85vh; width: auto;">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Header with status indicators -->
        <div class="card-header bg-light border-bottom-0 pt-4 pb-0">
          <h1 class="mb-2">{{ event.title }}</h1>

          <div class="d-flex flex-wrap gap-3 mb-3">
            <span class="badge bg-primary text-white fs-6">
              {% if event.is_free or event.fee_amount == 0 %}
                Free
              {% else %}
                {{ event.fee_amount }} {{ event.fee_currency }}
                {% if event.early_bird_fee %}
                  <small>(Early bird: {{ event.early_bird_fee }})</small>
                {% endif %}
              {% endif %}
            </span>

            {% if event.unlimited_quota %}
            <span class="badge bg-success fs-6">Unlimited spots</span>
            {% elif event.quota_full %}
            <span class="badge bg-danger fs-6">Fully Booked (0 left)</span>
            {% else %}
            <span class="badge bg-info fs-6">{{ event.quota_left }} spots left</span>
            {% endif %}

            {% if event.is_expired %}
            <span class="badge bg-secondary fs-6">Registration Closed</span>
            {% endif %}
          </div>
        </div>

        <!-- Main content -->
        <div class="card-body">

          <!-- Key event info -->
          <ul class="list-group list-group-flush mb-4">
            {% if event.start_date %}
            <li class="list-group-item d-flex justify-content-between">
              <strong>Date:</strong>
              <span>{{ event.start_date|date:"d F Y" }}</span>
            </li>
            {% endif %}

            {% if event.appl_deadline %}
            <li class="list-group-item d-flex justify-content-between">
              <strong>Application Deadline:</strong>
              <span>{{ event.appl_deadline|date:"d F Y" }}</span>
            </li>
            {% endif %}

            {% if event.location %}
            <li class="list-group-item d-flex justify-content-between">
              <strong>Location:</strong>
              <span>{{ event.location }}</span>
            </li>
            {% endif %}
          </ul>

          <!-- Description -->
          <h5 class="mt-4 mb-3">About the Event</h5>
          <div class="event-description mb-4">
            {{ event.description|linebreaks }}
          </div>

          <!-- Registration / Action area -->
          <div class="text-center mt-5 pt-4 border-top">
            {% if event.is_announcement %}
              <p class="lead text-muted">
                This is an informational announcement — no registration required.
              </p>
            {% elif event.is_expired %}
              <div class="alert alert-secondary">
                <h5>Registration has closed</h5>
                <p>This event's application deadline has passed.</p>
              </div>
            {% elif event.quota_full and not event.unlimited_quota %}
              <div class="alert alert-danger">
                <h5>Sorry — this event is fully booked</h5>
                <p>No more spots are available.</p>
              </div>
            {% elif already_registered %}
              <div class="alert alert-success">
                <h5>You're already registered!</h5>
                <p>Thank you for signing up. We'll send you updates to {{ user.email|default:"your email" }}.</p>
              </div>
            {% else %}
              <a href="{% url 'activities:register' event_id=event.event_id %}"
                 class="btn btn-primary btn-lg px-5 py-3">
                Register Now
              </a>
              <p class="text-muted mt-3 small">
                Spots are limited — don't miss out!
              </p>
            {% endif %}
          </div>

        </div> <!-- card-body -->

        <!-- Footer with meta info -->
        <div class="card-footer text-muted small text-center">
          Event ID: {{ event.event_id }} • 
          Posted on: {{ event.created_at|default:"—"|date:"d M Y" }}
        </div>

      </div> <!-- card -->

    </div> <!-- col -->
  </div> <!-- row -->

</div> <!-- container -->

{% endblock %}
